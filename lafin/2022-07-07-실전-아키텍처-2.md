# 실전 아키텍처 - 2
>이 글은 개인의 경험을 기반으로 주관적인 의견을 상당히 포함하고 있습니다.<br>
>전문적인 소프트웨어 공학적인 글이 아닌 실무에서 혹은 공부할 때 도움이 될 만한 의견을 공유해보고자 합니다.<br>
>틀린 부분이 있을 수도 있어 지식의 목적보다는 많은 견해 중 하나 혹은 노하우 공유 정도로 참고해주시면 좋을 것 같습니다.<br>
>자바로 개발을 시작했기 때문에 자바진영에 관련된 얘기가 다소 포함되어 있습니다. <br>
>실질적인 전달 메시지에는 영향이 없으나 참고부탁드립니다.<br>

# 간단한 웹 서비스 구조 만들어보기
## 요구사항 정의
아래와 같이 간단한 요구사항으로 백엔드 웹 서버를 하나 만든다고 가정한다.<br>
언어 베이스는 제일 익숙한 `Java`로 예를 든다. (딱히 상관은 없다)<br>

- 서비스 목적 : 집안 물건의 재고 관리
- 기능명세
  - 물건의 이름, 수량을 입력받아 등록한다.
  - 물건의 고유번호와 이름을 입력받아 수정한다.
  - 물건의 고유번호와 수량을 입력받아 재고를 차감시킨다.
  - 물건의 고유번호와 수량을 입력받아 재고를 증가시킨다.
  - 물건의 고유번호를 입력받아 삭제한다.

## 단순하게 설계해보기
위 와 같이 간단한 CRUD를 구현은 웬만한 개발자들은 몇시간도 안 걸려서 만들 것이다.<br>
여태껏 해왔던 대로(?) 마음가는대로 단순하게 프로젝트 레이어 구조를 짠다면 아래와 같이 짤 수 있다.<br>
```
Project
├─controller
├─service
└─dao
```
각 레이어를 설명하면 아래와 같다.<br>
- controller : HTTP 요청을 받아 알맞은 로직을 수행하고 응답처리
- service : DAO를 통해 저장된 정보를 바탕으로 비즈니스 로직을 처리
- dao : DB에 액세스하여 데이터를 저장, 조회, 변경, 삭제처리

이 구조를 보고 너무 단순하고 당연하다고 생각하거나 많이 부족하다고 느낄 수도 있다.<br>
하지만 웹 프로그래밍 초창기부터 이렇게 구조를 만들고 웹 페이지를 만들지는 않았다.<br>
당연히 스프링같은 프레임워크나 ORM도 없었다.<br>
여기서 제일 중요한 사실은 모든 것은 불편함을 해소하기 위한 필요성에 의해 정의되고 사용되어 온 것이라는 점을 항상 새겨두어야한다고 생각한다. <br>

## 필요할 때 마다 추가해보기
이렇게 요구사항에 맞춰 구조를 짜고 프로그램도 완성했고 프론트엔드, 앱에서 API를 연동하여 서비스하고 있다고 치자.<br>
막상 사용해보니 서비스가 조금 부족한 것 같다. 그래서 아래와 같이 추가 요구사항을 만들어 보았다.<br>

- 추가 요구사항
  - 수량에 대한 단위를 선택하고 싶다. (cm, ml, % 등)
  - 물건 재고에 따라 상태값을 표시하고 싶다. (사용중, 사용안함, 재고없음)
  - 물건 재고를 전부 사용했을 경우 알림을 받고 싶다. (SMS, Email 등)

일단, 물건에 대한 정보가 단위, 상태값 2가지가 새로 추가되었다.<br>
여기에 재고를 전부 사용했을 때 알림을 날려주는 기능도 필요해졌다.<br>
일단 단위나, 상태값에 대한 타입을 Enum으로 만들면 될 것같고, 여러 레이어에서 공통으로 사용될 것으로 생각된다.<br>
그리고 알림을 구현하기 위해 외부 시스템을 이용해야 하므로 이 또한 따로 관리가 되어야 할 것 같다.<br>
추가 요구사항을 고려해 변경된 구조는 아래와 같으며, 좀 더 구체적인 예시를 위해 파일도 같이 표기한다.<br>
```
Project
├─controller
│      ProductController.java
│
├─dao
│      ProductDao.java
│
├─service
│      ProductService.java
│
├─shared
│  ├─status
│  │      ProductStatus.java
│  │
│  └─type
│          Unit.java
│
└─thirdparty
    ├─mailer
    │      MailSender.java
    │
    └─sms
            SmsSender.java
```
추가된 레이어의 설명은 아래와 같다.<br>

- shared : 공통으로 사용될 상수, 타입, 상태 등의 클래스를 포함
- thirdparty : 기타 외부 시스템 라이브러리를 포함

물론 당연하게도 이 구조가 정답은 아니다. 이보다 훨씬 확장성 있고, 재사용성이 높게 만들 수도 있고, 역량에 따라 천차만별일 것이다.<br>
하지만 이렇게 구조를 새로 만들 때 어떤식으로 접근하고 고민했는가에 대한 과정이 가장 중요하다고 생각한다.<br>

우선, `shared` 레이어의 경우 enum 타입을 그대로 `DB`에 저장하고 싶거나 그대로 응답에 사용하고 싶을 수도 있고, 딱히 변경 시 비즈니스 로직에 영향을 주는 부분이 적을 것이라고 판단이 되어 아예 여러 레이어에서 사용될 수 있는 공용의 레이어를 만들었다.<br>

`thirdparty`의 경우 현재 시스템 상 `DB` 역시 외부시스템이나 기본적으로 사용하고 있고, 대다수 애플리케이션에서 `DB`는 기본옵션이기 때문에 그 외 다른 외부 시스템들을 한군데로 모으는 레이어를 만들었다.<br>

간혹 주변 개발자들과 대화를 할 때면 설계라는 단어의 의미를 굉장히 심오한 느낌으로 받아들이고 있다고 느껴졌다.<br>
요구사항 외에 추후 변경가능성, 확장가능성에 따라 최대한 고려하여 설계해야 한다는 강박관념이라고나 해야할까.<br>
물론 그렇게 설계하고 잘 대비가 되면 좋겠지만 그런 경우는 거의 못봤다. <br>
그래서 `XP`라는 방법론이 괜히 나온 것일까 생각이 든다. 필요한건 필요할 때 만드는게 제일 빠르게 실패하고 성장하는 방법인 것 같다.<br>

## 스스로 불편해하기
추가된 정보와 기능으로 서비스가 한층 편리해졌지만 이슈가 생기면 대응 할 때마다 난감한 경우들이 있다.<br>
예상가능한 난감한 경우들에 대해 아래 간략히 살펴본다.<br>

- 추가되는 정보에 따라 메소드의 매개변수가 끝도없이 늘어난다.
- Null 처리 등 단순한 로직의 중복이 많아서 코드가 길어진다.

위 문제에 대해 개발자들은 쉽게 해결책을 낸다.<br>
DTO를 추가하고 빌더패턴을 적용하고 유틸클래스를 만드는 등 많은 해결책이 있다.<br>

여기서 중요한건 이 작업을 설계단계에서 했을 때의 좋은 점이다.<br>
단순히 DB 구조 설계하고 패키지 구조를 만들고 데이터 흐름을 짜는 것처럼 큰 그림만 보고 설계하면 단점이 좀 있는 것 같다.<br>
설계단계에서도 어느정도의 디테일은 신경써야 한다고 생각한다.<br>

## 끝날 때 까지 끝난게 아니다
개발자는 천재들이 아니다. 프로그램을 만들고 나서 혹은 만들면서 아니면 만들기 전에 문서작업은 짜증나지만 필수다.<br>
개인적으로 개발문서는 크게 두가지로 구분한다.<br>

- 실제로 도움되는 문서
- 아닌 문서

논문처럼 어디가서 전문적으로 썼다고 자랑할게 아니라면 혹은 산출물로 제출해야하는게 아니라면 개발문서는 오롯이 작업자 위주로 작성해야 한다고 생각한다.<br>
물론 상세하면 상세할수록 정보가 많을수록 좋은 것일 수도 있으나 현실에서 문서에 그렇게까지 시간을 많이 투자하기는 어려운 일이기도 하고<br>
팀원들이 이해하기 힘든 문서일수록 오히려 역효과가 발생할 여지도 생긴다.<br>
개인적으로 문서를 쓸 때 시간이 부족하다면 아래의 우선순위로 문서를 만든다.<br>

- 시스템 정보 (서버 접속정보, DB 접속정보 등)
- 배포 매뉴얼
- 시스템 구성도 (인프라 구조, 외부 연동)
- 프로젝트 구조
- DB 명세서

요구사항 정의는 기본적으로 있다고 가정하에 실제 업무를 할 때 알아야될 우선순위에 따라 구분했다.<br>
팀이나 개인이 실제 업무를 할 때 어떤 방식으로 하는지나 알아내기 쉬운지 어려운지를 파악하는 정도에 따라 기준을 나눌 수 있다.<br>
개발자가 소스를 보며 파악할 수 있는 정보들도 상당히 많지만 그 시간을 최대한 줄이고자 하는 것이 문서라고 생각한다.<br>
당장에 단순한 시스템이라도 문서를 작성하는 습관이 없으면 향후 아주 큰 치명상을 입을 수 있기에 조금 시간을 더 투자해서라도 문서에 힘을 실어야 한다고 생각한다.<br>

# 마치며
설계를 할 때 가장 어렵게 하는 것은 정답을 찾는 것이다.<br>
설계엔 정답이 없으며, 다른 사람들이 올려놓은 글이나 영상 등을 봐도 비즈니스, 언어, 프레임워크, 통신방식 등 많은 요인에 따라 다르기 때문에<br>
여러 레퍼런스들을 나만의 필터링을 거쳐 활용하는 능력이 중요한 것 같다.<br>

여기서 시니어의 일은 설계하고 주니어 개발자들이 코딩하게 지시하는 것이 옛말이라는 것을 느낄 수 있었다.<br>
물론 맞는말이지만 안에 숨겨진 의미는 요구사항에 맞춰 DB만 설계하고 실제 구현은 크게 신경쓰지 않는다는 것이다.<br>
개발 중 문제가 생겼을 때 그것을 포괄적으로 방법만 제시하는 것보다는 시니어가 먼저 프로토타입을 만들고 코딩하고 맨땅에 헤딩 해봐야한다고 생각한다.<br>
거기에 더불어 문서작업은 협업뿐만 아니라 나 자신에게도 중요한 참고서가 되기 때문에 문서 작업도 중요하다고 볼 수 있다.<br>

이 글에서 나온 구조들은 거의 10년전 자바개발을 할 때 있었던 경험들을 기반으로 하여 현재 트렌드에 크게 도움이 안될 수도 있다.<br>
프레임워크나 ORM 등 외부 시스템 여부에 따라 레이어는 더 추가되거나 명칭이 달라질 수 있겠지만 본질은 변하지 않는다고 생각한다.<br>
지금 현업에서 본인의 회사에서 나온 그 구조가 어떻게 설계되었고, 무슨 목적을 가지고 만들어졌는지 궁금해 할 계기가 되면 좋을 것 같다.<br>
