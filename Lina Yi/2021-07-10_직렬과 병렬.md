

<img src = "https://user-images.githubusercontent.com/15938354/125147475-863d2500-e166-11eb-947f-06212d32f0b5.jpg" width="600px">


CPU나 HDD 등의 하드웨어 성능은 제품에 따라 차이가 나지만, 성능이 아무리 좋은 하드웨어라도 혼자서 처리할 수 있는 양이 정해져 있다.

그림을 보면, 특정 기간 내에 하나의 CPU로 처리할 수 있는 양에는 한계가 있지만, 여러 개의 CPU를 배치하면 처리량을 늘릴 수가 있다.

단, 다수의 CPU를 이용할 수 있는 처리여야 한다는 전제 조건이 있다.

분담하여 병렬화할 수 없는 처리는 CPU 코어를 아무리 늘려도 효과가 없다.

이때는 CPU 클럭 주파수를 올리는 방법, 즉 직렬 처리 속도를 올리면 고속 처리가 가능하다.

또한, 도로와 마찬가지로 처리 특성에 따라서 병렬화할 수 있는 것과 없는 것이 있다.

따라서 직렬 처리가 분기해서 병렬로 되거나, 다시 합류해서 직렬로 되기도 한다.

이 합류점, 직렬화 위치, 분기점이 병목 현상이나 문제가 발생하기 쉬운 지점이 된다.

병렬 처리를 할 때는 가증한 한 병렬화해서 직렬 부분을 줄이고, 어쩔 수 없이 직렬화 하는 경우에는 효율성을 높이는 것이 중요하다.

또한, 병렬화에서는 분담해서 일을 진행한 것을 다시 한 곳에 모으는 데 오버헤드가 걸린다.

무리해서 병렬화하면 직렬 처리에 의해 속도가 느려지는 경우가 많다.

병렬화 할 때는 오버헤드를 예상해서 어떤 부분을 병렬화할지 파악하는 것이 중요하다. 


직렬/병렬의 중요 사항을 정리하면 다음과 같다.
- 직렬 처리로 속도를 올리는 데는 한계가 있다.
- 병렬화를 통해 속도는 빨라지지 않지만, 단위 시간 당 처리량을 늘릴 수 있다.
  - 병렬 처리에서는 합류점, 직렬화 구간, 분기점이 병목 지점이 되기 쉽다.
  - 병렬화할 때는 일을 분담해서 처리를 한 후 다시 집약할 때 오버헤드가 걸린다. 그러므로 이 오버헤드를 감안하더라도 효과가 있을 경우에 병렬화를 한다.   


# 어디에 사용되나?

## 웹 서버와 AP 서버에서의 병렬화
그림 4.3은 웹 서버와 AP 서버 내부 처리를 간략화해서 표시한 것이다.

웹 서버에는 다수의 이용자가 접속하기 때문에 복수의 프로세스가 분담해서 병렬 처리를 하고 있다.

AP 서버에서는 JVM 프로세스가 하나이지만, 복수의 스레드가 병렬로 처리하고 있다.

Apache HTTP Server (이후 아파치)에서는 이번에 소개한 멀티 프로세스 모델 외에도 멀티 프로세스와 멀티 스레드를 모두 이용하는 하이브리드형도 있다.

JVM 프로세스를 복수 가동하면 멀티 프로세스와 멀티 스레드를 이용할 수 있다. 

<img src = "https://user-images.githubusercontent.com/15938354/125147493-9e14a900-e166-11eb-96e5-c70de7cb4f55.jpg" width="600px">
 
그림 4.3에서 아파치는 1 프로세스 1 스레드, JVM은 1 프로세스 4 스레드 이지만, 하나의 CPU 코어를 동시에 사용할 수 있는 것은 1 스레드다.

예를 들어, 하나의 CPU 코어 밖에 없는 서버에서는 아파치 프로세스를 아무리 늘려도 동시에 실행할 수 있는 것은 1 프로세스 뿐이다.

프로세스나 스레드 수를 조정할 때는 CPU 코어 수도 함께 고려해야 한다. 편의점 계산대가 하나밖에 없다면 계산대를 담당하는 사람이 여러 명이라도 소용 없는 것과 마찬가지이다. 



# 정리

직렬과 병렬의 장단점을 정리해 보았다.

## 직렬/병렬의 장단점
### 직렬
#### 장점
구조가 간단해서 설계나 구현 난이도가 낮다

#### 단점  
복수의 리소스(컴퓨터나 프로세서 등)을 유용하게 이용할 수 없다

### 병렬

#### 장점
복수의 리소스(컴퓨터나 프로세서 등)을 유용하게 이용할 수 있으며, 직렬에 비해 동일 시간 당 처리할 수 있는 양이 증가한다.

또한, 일부가 고장나더라도 처리를 계속할 수 있다

#### 단점
처리 분기나 합류를 위한 오버헤드가 발생한다. 배타적 제어 등을 고려해야 하고 구조가 복잡해서 설게 구현 난이도가 높다.


# 병렬화 시에 주의할 점

- 병렬화에서는 직렬 처리 성능은 향상되지 않지만, 단위 시간 당 처리량을 늘릴 수 있다.
- 병렬 처리에서는 합류점, 직렬화 구간, 분기점이 병목 지점이 되기 쉽다.
- 병렬화가 유효한 부분을 파악해서 병렬화하지 않으면 효과가 없다. 오버헤드나 구조 복잡화 등의 단점이 있다는 것을 고려한 후, 이 단점 이상의 효과를 얻을 수 있는 경우에 병렬화한다.



- 인프라를 지탱하는 기본 이론
