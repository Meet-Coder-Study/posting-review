---
title: autoë¡œ ë²„ì „ê´€ë¦¬ì™€ ë°°í¬ê´€ë¦¬í•˜ê¸°
date: 2022-03-10
tags: ["ì‚¬ìš©ê¸°"]
keywords: ["auto", "ë²„ì „ê´€ë¦¬", "publish", "release workflow"]
---

# autoë¡œ ë²„ì „ê´€ë¦¬ì™€ ë°°í¬ê´€ë¦¬í•˜ê¸°

autoë¥¼ í™œìš©í•´ release ë²„ì „ê´€ë¦¬ì™€ ìë™ë°°í¬ë¥¼ ì‘ì—…í•œ ê²½í—˜ì„ ë‹¤ë£¨ì—ˆìŠµë‹ˆë‹¤.

í˜¹ì‹œ AUTO ë¼ê³  ë“¤ì–´ë³´ì…¨ë‚˜ìš”?? ì €ëŠ” storybookì„ ê°œë°œí•˜ë©° autoë¥¼ ì²˜ìŒ ì ‘í–ˆëŠ”ë°ìš” íƒœê¹…ê³¼ CHANGELOGë¥¼ ì•Œì•„ì„œ ì‘ì„±í•´ì£¼ëŠ” ì‘ì—…ì´ í¸ë¦¬í•˜ì—¬ ê°œì¸í”„ë¡œì íŠ¸ì—ì„œë„ autoë¥¼ í™œìš©í•´ ë²„ì „ê´€ë¦¬ë¥¼ í•˜ê³  ìˆìŠµë‹ˆë‹¤.

## AUTOë€?

![img](./image/auto.png)

https://intuit.github.io/auto/

autoëŠ” `label`ì„ ì´ìš©í•´ ë²„ì „ê´€ë¦¬ì™€ ë°°í¬ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

<details>
  <summary>autoì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” <code>label</code>ë“¤ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</summary>

```jsx
[
  {
    name: "major",
    changelogTitle: "ğŸ’¥ Breaking Change",
    description: "Increment the major version when merged",
    releaseType: "major",
    color: "#C5000B",
  },
  {
    name: "minor",
    changelogTitle: "ğŸš€ Enhancement",
    description: "Increment the minor version when merged",
    releaseType: "minor",
    color: "#F1A60E",
  },
  {
    name: "patch",
    changelogTitle: "ğŸ› Bug Fix",
    description: "Increment the patch version when merged",
    releaseType: "patch",
    color: "#870048",
  },
  {
    name: "skip-release",
    description: "Preserve the current version when merged",
    releaseType: "skip",
    color: "#bf5416",
  },
  {
    name: "release",
    description: "Create a release when this pr is merged",
    releaseType: "release",
    color: "#007f70",
  },
  {
    name: "internal",
    changelogTitle: "ğŸ  Internal",
    description: "Changes only affect the internal API",
    releaseType: "none",
    color: "#696969",
  },
  {
    name: "documentation",
    changelogTitle: "ğŸ“ Documentation",
    description: "Changes only affect the documentation",
    releaseType: "none",
    color: "#cfd3d7",
  },
  {
    name: "tests",
    changelogTitle: "ğŸ§ª Tests",
    description: "Add or improve existing tests",
    releaseType: "none",
    color: "#ffd3cc",
  },
  {
    name: "dependencies",
    changelogTitle: "ğŸ”© Dependency Updates",
    description: "Update one or more dependencies version",
    releaseType: "none",
    color: "#8732bc",
  },
  {
    name: "performance",
    changelogTitle: "ğŸ Performance",
    description: "Improve performance of an existing feature",
    releaseType: "patch",
    color: "#f4b2d8",
  },
];
```

</details>

descriptionì„ ë³´ë©´ ì•Œê² ì§€ë§Œ `skip-release`ë‚˜ `documentaion` ë¼ë²¨ì„ ë‹¬ë©´ ë°°í¬ë¥¼ í•˜ì§€ì•Šê³  `major`ë‚˜ `minor`, `patch` ë¼ë²¨ì„ ë‹¬ë©´ ë°°í¬ë¥¼ í•©ë‹ˆë‹¤.

### auto ì„¤ì¹˜

ë¨¼ì € autoë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```shell
yarn add -D auto
```

### GitHub Token ë“±ë¡

ë‹¤ìŒìœ¼ë¡œ GitHub Tokenì´ í•„ìš”í•©ë‹ˆë‹¤. GitHub Tokenì´ í•„ìš”í•œ ì´ìœ ëŠ” autoê°€ ìƒì„±í•œ ë¼ë²¨ë“¤ê³¼ CHANGELOGë¥¼ GitHubì— í‘¸ì‹œ & ì»¤ë°‹í•˜ê³ , GitHubì— tagë¥¼ fetch & pushí•˜ê¸° ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤.

https://github.com/settings/tokens í˜ì´ì§€ë¡œ ë“¤ì–´ê°€ tokenì„ ë°œê¸‰ë°›ìœ¼ë©´ ë©ë‹ˆë‹¤.

![img](./image/github-token.png)

ì´í›„ ë°œê¸‰ë°›ì€ í† í°ì„ CI Serverì˜ Secretsì— ë“±ë¡í•©ë‹ˆë‹¤. ì €ëŠ” GitHub Actionì„ ì‚¬ìš©í•˜ê¸°ì— GitHub Action Secretsì— ë“±ë¡í•˜ê² ìŠµë‹ˆë‹¤.

![img](./image/github-action-secrets.png)

### Labels ìƒì„±

```shell
GH_TOKEN=YOUR_TOKEN auto create-labels
# or with .env file
auto create-labels
```

GitHub repoì— labelsë¥¼ ì…‹íŒ…í•´ì•¼ í•©ë‹ˆë‹¤. autoì—ì„œ ì‚¬ìš©í•˜ëŠ” labelì˜ íƒ€ì…ë“¤ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- Versioning Labels - ë²„ì „ì„ ê³„ì‚°í•˜ê³  releaseë¥¼ ìƒì„±í•˜ëŠ” ë¼ë²¨ë“¤

  ```json
  {
    "labels": [
      { "releaseType": "major", "name": "Version: Major" },
      { "releaseType": "minor", "name": "Version: Minor" },
      { "releaseType": "patch", "name": "Version: Patch" },
      { "releaseType": "skip", "name": "NO!" },
      { "releaseType": "release", "name": "Autobots, rollout!" }
    ]
  }
  ```

  - `major`: ë²„ì „ì˜ ì²« ë²ˆì§¸ ìˆ«ì ì¦ê°€ `v1._._`
  - `patch` `bug`: ë²„ì „ì˜ ë‘ ë²ˆì§¸ ìˆ«ì ì¦ê°€ `v_.1._`
  - `minor`: ë²„ì „ì˜ ì„¸ ë²ˆì§¸ ìˆ«ì ì¦ê°€ `v_._.1`

- Changelog Labels - ë²„ì „ì—ëŠ” ì˜í–¥ì´ ì—†ì§€ë§Œ ë³€ê²½ëœ ë¶€ë¶„ì„ changelogì— ë°˜ì˜í•˜ëŠ” labelë“¤, í•´ë‹¹ ë¼ë²¨ë“¤ì€ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
  ```json
  {
    "labels": [
      {
        "releaseType": "internal",
        "name": "Changes only affect the internal API"
      },
      {
        "releaseType": "documentation",
        "name": "Changes only affect the documentation"
      }
    ]
  }
  ```
  ```json title="ì»¤ìŠ¤í„°ë§ˆì´ì§• ë¼ë²¨ ì˜ˆì‹œ (auto.config.js)"
  {
    "labels": [
      {
        "name": "typescript",
        "changelogTitle": "TypeScript Rewrite"
      }
    ]
  }
  ```

### ë¦´ë¦¬ì¦ˆ

autoë¡œ ë¦´ë¦¬ì¦ˆë¥¼ í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ ë‘ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

1. `auto shipit` - `auto`ë¡œ ëª¨ë“  ê²ƒì„ í•œë‹¤.
2. Sub Commands - ê° ëª…ë ¹ì„ ì§ì ‘ ì‹¤í–‰

#### `auto shipit`

version, changelog, publish, release ë¥¼ ëª¨ë‘ ì•Œì•„ì„œ í•´ì¤ë‹ˆë‹¤.

![img](./image/auto-release-pipeline.png)

#### Sub Commands

`shipit`ëŠ” ê° ê¸°ëŠ¥ì„ ë‹´ë‹¹í•˜ê³  ìˆëŠ” `auto`ì˜ ì—¬ëŸ¬ commandë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ëŸ° ë°©ì‹ì„ ì›í•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆê¸°ì—
scriptsë¥¼ í†µí•´ commandë¥¼ customí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

```json
{
  "scripts": {
    "release": "./scripts/release.sh"
  }
}
```

```shell title="release.sh"
export PATH=$(npm bin):$PATH

VERSION=`auto version`

## Support for label 'skip-release'
if [ ! -z "$VERSION" ]; then
  ## Fetch tags
  git fetch --tags
  ## Update Changelog
  auto changelog

  ## Publish App
  npm version $VERSION -m "Bump version to: %s [skip ci]"
  expo publish --non-interactive

  ## Create GitHub Release
  git push --follow-tags --set-upstream origin $branch
  auto release
fi
```

> ì˜ˆì‹œì—ì„œëŠ” React-Native ë°°í¬ í”„ë¡œì„¸ìŠ¤ë¼ expoë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

## GitHub Actions

auto release ìŠ¤í¬ë¦½íŠ¸ë„ ë‹¤ ì§°ìœ¼ë‹ˆ GitHub Actionì˜ CD scriptë¥¼ ì§œë³´ê² ìŠµë‹ˆë‹¤.

```yml
name: CD

on:
  push:
    branches:
      - main
jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ— Setup repo
        uses: actions/checkout@v2

      - name: ğŸ— Setup Node
        uses: actions/setup-node@v2
        with:
          node-version: 16.x
          cache: yarn

      - name: ğŸ— Setup Expo
        uses: expo/expo-github-action@v7
        with:
          expo-version: latest
          token: ${{ secrets.EXPO_TOKEN }}

      - name: ğŸ“¦ Install dependencies
        run: yarn install --immutable --immutable-cache

      - name: ğŸš€ Publish app
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: yarn release
```

## ë ğŸ‰

ì´ì œ ëë‚¬ìŠµë‹ˆë‹¤!!!

ì œê°€ prì„ ì‘ì„±í•  ë•Œ ë¼ë²¨ë§Œ ë‹¬ì•„ì£¼ë©´ ë²„ì „ ì—…, changelog ì‘ì„±, tagë¥¼ í†µí•œ releaseê°€ ìë™í™”ë©ë‹ˆë‹¤.

#### pr with labels

![img](./image/pr.png)

#### Changelog

![img](./image/changelog.png)

#### Release tags

![img](./image/release.png)
