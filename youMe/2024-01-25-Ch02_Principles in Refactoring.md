# Chapter 02 리팩터링 원칙

1. 리팩터링 정의

   ```
   💡 리팩터링: [명사] 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법

   💡리팩터링(하다): [동사] 소프트웨어의 걸보기 동작은 그대로 유지한 채, 여러 가지 리팩터링 기법을 적용해서 소프트웨어를 재구성하다.
   ```

   리팩터링은 코드를 이해하고 수정하기 쉽게 만드는 것이 목적이며, 성능 최적화와는 목표와 방법이 다르다. 성능 최적화는 속도 개선에만 집중하므로 코드가 더 복잡해질 수 있다.

---

2. 두 개의 모자

   소프트웨어 개발 시 '기능 추가'와 '리팩터링'을 명확히 구분하여 작업하는 것이 중요하다. 기능 추가 시에는 기존 코드를 건드리지 않고 새로운 기능만 추가하며, 테스트를 통과하는지 확인한다. 리팩터링 시에는 코드 재구성에만 전념하고, 기능 추가는 하지 않는다. 인터페이스 변경이 필요한 경우에만 기존 테스트를 수정한다.

---

3. 리팩터링하는 이유
   - 소프트웨어 설계가 좋아진다.
   - 소프트웨어를 이해하기가 쉬워진다.
   - 버그를 쉽게 찾을 수 있다.
   - 프로그래밍 속도를 높일 수 있다.

---

4. 언제 리팩터링을 해야 할까?

   ```
   3의 법칙

   1. 처음에는 그냥 한다.
   2. 비슷한 일을 두 번째로 하게 되면 (중복이 생겼다는 사실에 당황스럽겠지만) 일단 계속 진행 한다.
   3. 비슷한 일을 세 번째 하게 되면 리팩터링 한다.
   ```

   - 준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기
   - 이해를 위한 리팩터링: 코드를 이해하기 쉽게 만들기
   - 쓰레기 줍기 리팩터링
   - 계획된 리패터링과 수시로 하는 리팩터링
     - 보기 싫은 코드를 발견하면 리팩터링 하자. 그런데 잘 작성된 코드 역시 수많은 리팩터링을 거쳐야 한다.
     - 무언가 수정하려 할 때는 수정하기 쉽게 정돈하고 그런 다음 쉽게 수정하자.
   - 오래 걸리는 리팩터링
   - 코드 리뷰에 리팩터링 활용하기
   - 관리자에게는 뭐라고 말해야 할까?
     새 함수를 추가하려는데 현재 설계가 적합하지 않다면 먼저 리팩터링하고 나서 함수를 추가하는 편이 빠르다. 버그를 수정하려면 현재 소프트웨어의 작동 방식을 이해해야한다. 이때도 리팩터링부터 하는 편이 가장 빠르다. 일정을 최우선으로 여기는 관리자는 최대한 빨리 끝내는 방향으로 진행하기를 원한다. 그리고 구제적인 방법은 개발자가 판단해야 한다. 프로 개발자에게 주어진 임무는 새로운 기능을 빠르게 구현하는 짓이고, 가장 빠른 방법은 리팩터링이다. 그래서 리팩터링부터 한다.
   - 리팩터링 하지 말아야 할 때
     내부 동작을 이해해야 할 시점에 리팩터링해야 효과를 제대로 볼 수 있다.

---

5. 리팩터링 시 고려할 문제
   - 새 기능 개발 속도 저하
     - 리팩터링의 궁극적인 목적은 개발 속도를 높여서, 더 적은 노력으로 더 많은 가치를 창출하는 것이다.
   - 코드 소유권
   - 브랜치
   - 테스팅
   - 레거시코드
   - 데이터베이스
     데이터베이스 리팩터링은 프로덕션 환경에 여러 단계로 나눠서 릴리스하는 것이 대체로 좋다는 점에서 다른 리팩터링과 다르다. 이렇게 하면 프로덕션 환경에서 문제가 생겼을 때 변경을 되돌리기 쉽다. 이를테면 필드 이름을 바꿀 때 첫 번째 커밋에서는 새로운 데이터베이스 필드를 추가만 하고 사용하지는 않는다. 그런 다음 기존 필드와 새 필드를 동시에 업데이트하도록 설정한다. 그다음에는 데이터베이스를 읽는 클라이언트들을 새 필드를 사용하는 버전으로 조금씩 교체한다. 이 과정에서 발생하는 버그도 해결하면서 클라이언트 교체 작업을 모두 끝냈다면, 더는 필요가 없어진 예전 필드를 삭제한다. 이렇게 데이터베이스를 변경하는 방식은 병렬 수정의 일반적인 예다.

---

6. 리팩터링, 아키텍처, 애그니(YAGNI)

   리팩토링을 통해 현재까지 파악한 요구사항을 해결하는 소프트웨어를 구축하고, 변경에 유연하게 대응하기 위해 설계를 간결하고 점진적으로 진행하는 방식을 YAGNI로 부른다. 리팩토링을 미루면 어려워지므로 유연성 메커니즘은 검증 후 추가해야 한다.

---

7. 리팩터링과 소프트웨어 개발 프로세스

   리팩터링의 첫 번째 토대는 자가 테스트 코드다. 또한 팀으로 개발하면서 리팩터링을 하려면 각 팀원이 다른 사람의 작업을 방해하지 않으면서 언제든지 리팩터링 할 수 있어야 한다.

   자가 테스트 코드, 지속적 통합, 리팩터링이라는 세기법은 서로 강력한 상승효과를 발휘한다.

---

8. 리팩터링과 성능

   리팩터링은 성능 좋은 소프트웨어를 만드는 데 기여한다. 단기적으로 보면 리팩터링 단계에서는 성능이 느려질 수도 있다. 하지만 최적화 단계에서 코드를 튜닝하기 훨씬 쉬워지기 때문에 결국 더 빠른 소프드웨어를 얻게 된다.

---

9. 리팩터링의 유래

   리팩터링은 워드 커닝햄과 켄트 벡이 스몰토크를 활용해 개발하면서 중요성을 깨달았고, 스몰토크의 역동적인 환경과 객체 지향 언어의 특징을 통해 리팩터링이 생산성을 높이는 데 큰 역할을 한다는 것을 알게 되었다.

---

10. 리팩터링의 자동화

    자동 리팩터링은 리팩터링을 지원하는 도구가 등장한 가장 큰 변화이다. 자동 리팩터링은 개발 도구가 처리하며 안정적이다. 현재는 에디터나 독립 도구에서도 자동 리팩터링이 흔하게 제공되며, 정적 타입 언어를 사용하면 더 안전하게 구현할 수 있다. IDE를 사용하는 것이 효율적이며, 언어 서버 기술도 늘어나고 있다.

---
