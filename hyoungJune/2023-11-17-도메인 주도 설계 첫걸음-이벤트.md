> 해당 글은 도메인 주도 설계 첫걸음 (블라드 코노노프 지음, 김민석, 오창윤 옮김)을 정리한 글입니다.

## 이벤트란? 
- 이미 발생한 변화를 설명하는 메시지이다.
- 이벤트는 이미 발생한 일이므로, 이벤트 이름은 과거 시제로 표현한다.
- 이벤트는 도메인 객체 간의 느슨한 결합을 시킬 수 있다.
- 이벤트를 받는 쪽에서는 이벤트를 취소할 수 없다.

## 이벤트의 유형?
- 이벤트 알림
- 이벤트를 통한 상태 전송
- 도메인 이벤트

### 이벤트 알림
- 다른 컴포넌트가 반응할 비즈니스 도메인의 변경에 관한 메시지입니다.
- 당사자에게 이벤트를 알리는 것이 목적이기 때문에 구독자가 이벤트에 반응하는 데 필요한 모든 정보를 포함해서는 안된다.
- 자세한 정보를 가지고 올 수 있도록 링크를 전달한다.

```json
{
	"type" : "paycheck-generated",
	"event-id" : "537ec7c2",
	"delivery-id" : "05011927",
	"timestamp" : 161726445,
	"payload" : {
		"employee-id" : "456123",
		"link": "/paychecks/456123/2021/01"
	}
}
```
- 보안 : 민감한 정보가 메시지에 공유되지 않을 때 사용한다.
- 동시성 : 변화에 대해 민감할 수도 있어, 매번 최신 상태를 유지할 때 사용한다.
- 여러 명의 동시 구독자 중에 한 명의 구독자만 이벤트를 처리하는 경우 링크를 통하여 비관적 잠금 방식을 적용하여 사용한다.
### 이벤트를 통한 상태 전송
- 구독자에게 제공자의 내부 상태에 대한 변경사항을 알려준다.
- 수정 된 엔티티의 상태에 대한 완전한 스냅숏, 실제 수정 된 필드만 메시지에 포함하는 두 가지 스타일이 있다.
```json
{
	"type" : "customer-updated",
	"event-id" : "6b7ce6c6",
	"customer-id" : "01b18d56",
	"timestamp" : 1615728520,
	"payload" : {
		"first-name" : "Carolyn",
		"last-name" : "Hayes",
		"phone" : "555-1022",
		"status" : "follow-up-set",
		"follow-up-date" : "2021/05/08",
		"birthday" : "1982/04/05",
		"version" : 7
	}
}
```
> 수정 된 엔티티의 상태에 대한 완전한 스냅숏
```json
{
	"type" : "customer-updated",
	"event-id" : "6b7ce6c6",
	"customer-id" : "01b18d56",
	"timestamp" : 1615728520,
	"payload" : {
		"first-name" : "Carolyn",
		"last-name" : "Hayes",
		"version" : 8
	}
}
```
> 실제 수정 된 필드만 메시지

- 시스템의 내결함성이 향상되어 제공자 서비스가 가용하지 않은 경우라도 사용자는 계속해서 작업할 수 있다.
- 여러 소스의 데이터를 처리해야 하는 컴포넌트의 성능을 향상시킬 수 있다.
- 데이터가 필요할 때마다 데이터 소스를 질의하는 대신, 모든 데이터를 로컬로 캐시할 수 있다.

### 도메인 이벤트
- 도메인 이벤트에는 이벤트를 설명하는 모든 정보를 포함한다.
- 모델링의 의도가 다르다. 이벤트 알림은 다른 컴포넌트와의 연동을 돕기 위해 설계된 반면, 도메인 이벤트는 비즈니스 도메인을 모델링하고 설명하기 위한 것이다.
- 이벤트를 통한 상태 정보는 로컬 캐시로 보유하기에 충분한 정보를 제공하는 반면, 도메인 이벤트는 풍부한 모델을 노출해서는 안된다. 그 이유는 사용자가 구독하지 않은 다른 도메인 이벤트가 동일한 필드에 영향을 줄 수 있기 때문이다.
- 도메인 이벤트는 애그리게이트의 상태를 설명하기 위한 것이 아닌, 수명 주기 동안 발생한 비즈니스 이벤트를 설명한다.

```json
eventNotification = {
	"type" : "marriage-recorded",
	"person-id" : "01b9a761",
	"payload" : {
		"person-id" : "126a7b61",
		"details" : "/01b9a761/marriage-date"
	}
}

eventCarriedStateTransfer = {
	"type" : "personal-details-chaged",
	"person-id" : "01b9a761",
	"payload" : {
		"new-last-name" : "Williams"
	}
}

domainEvent = {
	"type" : "married",
	"person-id" : "01b9a761",
	"payload" : {
		"person-id" : "126a7b61",
		"assumed-partner-last-name" : true
	}
}
```
