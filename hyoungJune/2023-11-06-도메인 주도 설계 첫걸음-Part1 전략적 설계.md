> 해당 글은 도메인 주도 설계 첫걸음 (블라드 코노노프 지음, 김민석, 오창윤 옮김)을 정리한 글입니다.

## 도메인 주도 설계 방법론이란?
도메인 주도 설계 방법론 (Domain-Driven Design: DDD)는 우리가 어떤 소프트 웨어를 만드는지 그리고 그 소프트웨어를 만드는지에 대한 해답을 찾으며, 소프트웨어 각각의 구성요소가 구현되는 방법을 찾는 것이다. 도메인 주도 설계 방법론은 전략적 설계와 전술적 설계로 이루어진다. 
- 전략적 설계 : 무엇?과 왜?라는 질문에 대한 정답을 찾아내는 것
- 전술적 설계 : 어떻게?라는 질문에 대한 정답을 찾아내는 것

# 전략적 설계

# 비즈니스 도메인 분석하기

## 비즈니스 도메인
기업의 주요 활동 영역을 정의하며, 회사가 고객에게 제공하는 서비스를 말한다.

## 하위 도메인
비즈니스 도메인의 목표를 달성하기 위한 도메인

### 핵심 하위 도메인 
경쟁업체와 다르게 수행하고 있는 것을 말한다. ex) 우버의 승차 공유 서비스
-  핵심 하위 도메인은 높은 진입장벽이 있어야하며, 경쟁사가 회사의 솔루션을 모방하거나 복제하기 어려워야 한다.
- 핵심 하위 도메인은 반드시 기술이 들어가야 하는 것은 아니다. 회사의 경쟁 우위는 그 밖에서도 찾을 수가 있다.
- 사내에서 구현되어야 한다. 
	-  하청 주는 것은 좋지 않다. 
	- 유지보수가 불가능한 코드가 될 수도 있기 때문이다.
	- 진보된 엔지니어링 기술로 구현해야 한다.

### 일반 하위 도메인 
모든 회사가 같은 방식으로 수행하는 비즈니스 활동을 말한다. 
-  일반 하위 도메인은 경쟁력을 제공하지 않는다.
- 검증된 솔루션으로도 충분히 이용 가능하다.
- 모든 회사에서 사용하고 있어서 혁신이나 최적화가 필요 없다.
- 같은 방식으로 수행하기 때문에 사내에서 구현하는 데 시간과 노력을 투자하는 것보다 이미 만들어진 제품을 구입하거나 오픈소스 솔루션을 채택하는 것이 비용 면에서 더 효율적이다.

### 지원 하위 도메인 
회사의 비즈니스를 지원하는 활동을 말한다.
- 구현이 간단해야하며, 변경의 빈도가 적어야한다.
- 아키텍처 무관 설계, 외부 솔루션 사용, PG사 사용
- 구현이 간단하기 때문에 인재를 양성할 수 있는 좋은 연습 기회
- 회사의 경쟁 우위도 제공하지 않기 때문에 높은 진입장벽이 필요하지 않다. (핵심 하위 도메인과 구별하기 위한 방법)

# 도메인 지식 찾아내기

## 비즈니스 문제
우리가 개발하는 소프트웨어 시스템은 비즈니스 문제를 해결하는 솔루션이다. 비즈니스 문제는 비즈니스 도메인과 하위 도메인의 모든 수준에서 발생할 수 있다.

## 도메인 지식 찾아내기
비즈니스 문제를 찾기 위해서는 도메인 전문가를 이해하고 동일한 비즈니스 용어를 사용하는 것이 중요하다. 프로젝트의 성공은 도메인 전문가와 소프트웨어 엔지니어 간의 효과적인 지식공유에 달렸고, 문제를 해결하려면 문제를 이해해야한다. 문제를 해결하기 위하여 도메인 주도 설계에서는 유비쿼터스 언어를 사용한다.

## 유비쿼터스 언어
비즈니스 도메인을 설명하기 위한 언어이다. 모든 프로젝트 참가자는 공통 된 언어인 유비쿼터스 언어를 사용해야 한다. 도메인 전문가와 소프트웨어 엔지니어의 지식 간극을 메워주는 효과적인 도구다.

## 비즈니스 언어
유비쿼터스 언어는 비즈니스 언어이다. 그러므로 기술 용어는 빼고 비즈니스 도메인에 관련된 용어로만 구성해야 한다. 도메인 전문가의 이해와 비즈니스 도메인에 대한 이해를 할 수 있도록 목표해야한다. 비즈니스 언어는 시나리오에 녹여야하며, 일관성있어야하며, 명확해야한다. 동의어가 생긴다면 특정 컨텍스트 내에서만 사용해야 한다.

## 비즈니스 도메인 모델

### 모델링이란?
모델은 우리가 필요한 것만 선택하여 표현한 것이며 대상을 단순화 한 것이라고 말한다. 

### 비즈니스 도메인 모델링
유비쿼터스 언어를 발전시키는 것은 비즈니스 도메인 모델을 구축하는 것이다. 계속 발견하고 발전시켜야하며, 도저히 안되거나 필요없는 것은 버려야한다. 즉, 소프트웨어가 해결하고자 하는 특정 문제를 해결하는 데 필요한 만큼의 비즈니스 도메인 관점을 포함하면 된다.

### 도구
비즈니스 도메인 모델링에 맞춰 유비쿼터스 언어 또한 발전해야 한다. 발전하기 위해서는 유비쿼터스 언어를 수집하고 관리하는 작업이 필요하다. 그 중에는 용어집을 만드는 방법이 있다.

# 도메인 복잡성 관리

## 바운디드 컨텍스트란 무엇인가?
바운디드 컨텍스트는 유비쿼터스 언어의 일관성이 유지되는 경계다. 
- 유비쿼터스 언어의 용어, 원칙, 비즈니스 규칙은 해당 바운디드 컨텍스트 내에서만 일관성이 있다.  
- 유비쿼터스 언어를 여러 개의 작은 언어로 나눈 다음 각 언어를 적용할 수 있도록 그룹화 시키면 바운디드 컨텍스트가 만들어진다. 
- 바운디드 컨텍스트에서 단일 의미를 갖는 한, 세분화된 유비쿼터스 언어 각각은 일관성을 띠며 도메인 전문가의 멘탈 모델을 따를 수 있다. 
- 명시적이고 중요한 비즈니스 도메인의 요소로 모델링할 수 있다.
- 큰 바운디드 컨텍스트에서 새분화된 바운디드 컨텍스트를 추출하면 팀을 구성하거나 시스템의 일부 비기능 요구사항을 해결할 수 있다.
- 같은 데이터에서 작동하는 응집된 유스케이스의 집합을 식별하되, 여러개의 바운디드 컨텍스트로 분해하면 안된다.
- 각 바운디드 컨텍스트의 수명주기는 서로 독립적이다.

바운디드 컨텍스트는 물리적 경계와 소유권 경계를 규정하기 위한 도메인 주도 설계 도구다.
- 물리적 경계 : 바운디드 컨텍스트는 개별 서비스/프로젝트로 구현돼야 한다.
- 소유권 경계 : 한 팀에서만 구현, 발전, 유지 관리해야 한다. 단, 분리된 모델과 시스템을 명시적으로 연동하기 위한 통신 프로토콜을 정의해야 한다.

# 바운디드 컨텍스트 연동

바운디드 컨텍스트 자체는 독립적이지 않다. 시스템의 요소는 독립적이지 않고, 서로 상호작용해야하기 때문이다.  바운디드 컨텍스트에서 팀 간의 협력을 위하여 `협력`, `사용자-제공자`, `분리형 노선` 세가지로 나눈다.

## 협력형 패턴 그룹
협력형 패턴은 소통이 잘 되는 팀에서 구현된 바운디드 컨텍스트와 관련이 있다. 

### 파트너십 패턴
애드혹(ad-hoc) 방식으로 조정한다. 한 팀은 다른 팀에게 API의 변경을 알리고 다른 팀은 충돌 없이 이를 받아들인다. 영동에 대한 부분을 서로 협력하여 문제를 해결해 나아간다. 성공적인 연동을 위해서는 잘 구축된 협업 실무, 높은 수준의 헌신, 팀 간의 잦은 동기화가 필수다. 단, 멀리 떨어져 있다면 적합하지 않을 수 있다.

### 공유 커널 패턴
공유 모델을 하나 둠으로써 이를 사용하는 모든 바운디드 컨텍스트에 걸쳐서 일관성을 유지하는 방법. 이 방법은 공유 모델의 소스코드의 모든 변경이 모든 바운디드 컨텍스트에 즉시 반영하여 지속적으로 통합해야 한다. 공유 커널은 라이브러리로도 사용할 수 있다. 공유 커널은 통합 비용과 중복 비용에서 통합 비용이 높아질 경우 사용이 되어 핵심 하위 도메인처럼 많이 변하는 하위 도메인에 적용 된다. (개인적인 생각으로, 바운디드 컨텍스트 간의 모든 경계에 대한 부분에서 중복 비용보다 통합 비용이 비싼 경우 사용이 되어지는 것 같다.)

## 사용자-제공자 패턴 그룹
제공자가 사용자에게 서비스를 제공하는 패턴이다.

### 순응주의자 패턴
제공자의 모델에 따라 사용자가 받아들이는 방법이다.

### 충돌 방지 계층
사용자가 제공자의 모델에 순응하지 않는 경우 스스로의 필요에 맞게 가공하는 하도록 계층을 만드는 방법이다.
- 다운스트림 바운디드 컨텍스트가 핵심 하위 도메인을 포함할 경우
	- 핵심 하위 도메인에 대한 모델링에 방해가 될 수 있기 때문이다.
- 업스트림 모델이 사용자의 요건에 비효율적이거나 불편한 경우
- 제공자가 컨트랙트를 자주 변경하는 경우

### 오픈 호스트 서비스 패턴
제공자가 사용자에게 맞게 서비스를 제공하는 패턴이다. 제공자의 퍼블릭 인터페이스는 자신의 유비쿼터스 언어를 따르는 대신 사용자에 맞게 모델을 만드는 방법이다.

## 분리형 노선
팀에 협업 의지가 없거나 협업할 수 없는 경우 사용한다.

### 커뮤니케이션 이슈
팀이 협업과 합의에 어려움이 겪고 있다면, 여러 바운디드 컨텍스트 내에서 기능을 중복해서 가져와 각자도생하는 방법이 더 비용 효과적이다.

### 일반 하위 도메인
일반 솔루션과 연동하는 것이 쉽다면 각 바운디드 컨텍스트 내에서 각자 연동하는 것이 더 효율적인 경우도 있다. ex) 로깅 프레임 워크

### 모델의 차이
모델이 너무 달라서 순응주의자 관계가 불가능하고, 충돌 방지 계층을 구현하는 것도 기능 중복보다 비용이 더 큰 경우 각자도생 하는 것이 더 비용 효과적이다.

## 컨텍스트 맵
시스템의 바운디드 컨텍스트 간의 연동 패턴을 분석하면, 컨텍스트 맵으로 그릴 수 있다. 컨텍스트 맵은 전체적인 안목을 주며, 커뮤니케이션에 대한 패턴을 볼 수 있고, 조직의 문제점 또한 파악할 수 있다. 
