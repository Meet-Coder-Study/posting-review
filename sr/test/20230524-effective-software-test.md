# 이펙티브 소프트웨어 테스팅 책을 읽고... (1)

이펙티브 소프트웨어 테스팅이라는 책을 한번 읽고, 내용을 정리해보고자 작성하는 글입니다.

책 내용을 읽기 전, 대상 독자는 테스트를 평소에 작성하되 직관적으로 작성하고 있는 개발자를 대상으로 사고의 전환을 도와주는 책입니다.

## 1. 효율적이고 체계적인 소프트웨어 테스트

1장의 목표는 아래와 같습니다. 

1. 효율적이고, 체계적인 소프트웨어 테스트가 중요한 이유
2. 소프트웨어 테스트는 왜 어려우며, 버그가 없는 시스템이 존재할 수 없는 이유
3. 테스트 피라미드란에 대한 이해

---

테스트 코드를 작성하고 있다는 가정에서 시작하여, 테스트 코드의 중요성에 대해서는 논의하지 않습니다.

다만, 개발자의 영향력에 대해서 돌아보면, 과거의 개발자의 영역은 자신이 만든 시스템(프로젝트)에 대한 권한과 책임이 있었다면, 현재는 시스템의 품질(서비스)에 대한 영역까지 넓혀졌다고 볼 수 있습니다.

> 소프트웨어 장애로 인한 영향이 `비즈니스와 사람`에서 `사회 전체`로 커짐

---

최근 대부분의 개발자들이 테스트의 중요성, 도구, 작성법 등 테스트 도구를 능숙하게 다루는 수준으로 올라와 있습니다.
하지만, 테스트를 작성할 때, 나름의 `체계`를 갖추고 있는지는 다시 한번 고민해봐야 합니다.

저자는 그러한 체계를 갖추기 위해, 우선 `테스트를 하는 이유`에 대해서 설명합니다.

1. 테스트로부터 피드백 (설계)
2. 버그 찾기

따라서 개발자는 아래의 목표를 갖도록 합니다.

1. 개발자로서 제품의 품질은 개발자의 책임이다.
2. 테스트는 그러한 책임감을 갖는데 도움을 줄 수 있는 유일한 도구이다.
3. 테스트 코드를 더욱 효율적이고 체계적으로 작성할 수 있다.

---

### 테스트 코드가 없는 상황과 있는 상황을 가정하고, 워크플로우를 비교

- 테스트 코드가 존재하지 않는 워크 플로우
  1. 요구사항 분석
  2. 코드 작성
  3. 수동 테스트 (기능 테스트)
  4. 배포 및 서비스 적용 
  5. 민원 (이슈)
  6. 실패 케이스에 대한 테스트
  7. 코드 수정
  8. 수동 테스트
  9. 배포 및 서비스 적용

여기서 고민해야 하는 부분은 수동 테스트이기 때문에 테스트 케이스(예시 기반 테스트)를 문서화하면서 수동 테스트를 진행해야 한다는 점입니다.

- `수동 테스트`
  - 저자는 수동 테스트를 `예시 기반 테스트`라는 용어로 정의하여 사용합니다.
  - 경험 또는 직감적인 테스트를 수행함으로써 코너 케이스에 대해 취약한 테스트를 진행할 수 있습니다.
  - 테스트를 수행하는 사람의 경험에 따라 테스트의 품질이 달라질 수 있습니다.
  - 수동으로 입력하기 때문에 테스트 시간 또한 오래 걸립니다.

그래서 결국, 테스트 케이스 작성 시 체계적인 접근법을 사용하여 코너 케이스와 같은 부분에 대해서 누락될 가능성을 낮춰야 합니다.
그리고 수동 테스트를 자동화된 테스트로 변경하여 테스트 시간을 단축시켜야 합니다.

- 테스트 코드가 존재하는 워크 플로우
  1. 요구사항 분석
  2. 코드 작성
  3. 테스트 코드 작성 (자동화 테스트)
  4. 테스트 실패 (Feedback)
  5. 실패 테스트에 대한 수정 개발 및 테스트 코드 작성
  6. 자동화 테스트
  7. 배포 및 서비스 적용
  8. 민원 (이슈)
  9. 실패 케이스 테스트
  10. 코드 수정
  11. 자동화 테스트
  12. 배포 및 서비스 적용

자동화 테스트가 존재한다고 해서 모든 버그가 사라진다는 것을 보장할 수는 없습니다.
하지만 서비스 운영시 발생할 수 있는 버그를 사전에 찾아내고, 테스트 코드를 통해 버그를 수정할 수 있습니다.

- `자동화 테스트`의 몇 가지 기준
  - 예시(특정 값 지정) 테스트가 아닌 `속성 기반 테스트`를 통해 코너 케이스에 대한 대비 (라이브러리 활용)
  - 사전 조건(유효성 검사)에 대한 피드백을 빠르게 받아 수정
  - 정상 동작 및 예외 동작에 대한 자동화된 테스트 케이스 작성
  - 테스트 케이스가 적용되지 않는 코드는 없는지 코드 커버리지 도구를 사용

---

### 효율적이고, 체계적인 테스트 코드를 작성하기 위한 개발 흐름

- 개발의 흐름
  1. 요구사항 분석
  2. 개발 구현을 위한 요구사항 도출
  3. TDD 및 작은 단위의 기능 구현
  4. 테스트 기법을 사용하여 자동화된 테스트 구현
  5. 대규모 테스트
  6. 지능형 테스트

저자가 제시하는 테스트를 적용하는 개발 흐름 그림입니다.

그림만 보면, 어떤 요구사항이든 버그 없는 서비스를 제공해주겠다. 느낌 일 수도 있지만 그건 허상..

---

### 테스트가 많다고해서 버그가 없는 것은 아니다.

---

테스트 비용

테스트가 많으면 좋아 보일 수도 있지만, 테스트 코드를 설계하는 것은 비용이 듭니다.
테스트 코드는 작성해야 하고, 유지보수도 해야한다고해서 작성을 안할 수는 없습니다.

테스트 코드가 없어서 생기는 이슈나 버그로 인한 사후처리 비용을 생각하면 테스트 코드를 작성하는 것이 더 효율적입니다.

---

### `효율적`이고, `체계적`이라는 것에 대한 의미

효율적이란?
 - 올바른 테스트를 작성하는 것이다. 그 말은 불필요한 테스트를 작성하지 않는 것이기도 하다.

체계적이란?
 - 어떠한 개발자라도 같은 테스트 스위트(특정 코드 조각들에 대한 테스트 케이스)를 만들어 내는 것이다.
 - 테스트 코드를 작성하는 방법에 대한 표준화를 의미한다.

두 가지 속성이 현실적으로 이루어지려면 `테스트 자동화`가 필수적입니다.

테스트 자동화를 위해서는 `테스트 프레임워크`에 대한 학습과 `테스트 케이스 설계`가 필요합니다.

테스트 프레임워크
 - Java 진영에는 JUnit과 같은 테스트 프레임워크가 존재하여, 책에서 이야기하는 기능 최소 단위들에 대한 테스트 스위트를 작성할 수 있습니다. 
 - 테스트 프레임워크는 단순 실행 및 결과에 대한 리포트를 보여주는 기능을 제공합니다.

테스트 케이스 설계
 - 소프트웨어 테스트 업무는 어려운 점은 테스트 케이스가 버그를 드러내도록 제대로 설계하는 일이다.
 - 테스트 케이스 설계는 테스트 케이스를 작성하는 것이 아니라, 테스트 케이스를 어떻게 작성할 것인지에 대한 설계이다.

> 결국, 테스트 프레임워크를 학습하는 것도 중요하고, 테스트 케이스 설계를 위해 요구사항 분석 및 클래스 설계를 하는 것도 중요하다.

---

### 소프트웨어 테스트 원칙

1. 완벽한 테스트는 불가능하다.
2. 테스트를 그만둘 때를 파악해야 한다.
3. 가변성이 중요하다.
4. 버그는 다른 곳에 비해 많이 발생하는 지점이 있다.
5. 어떤 테스트를 하든지 결코 완벽하거나 충분하지 않다.
6. 맥락이 핵심이다.
7. 검증은 유효성 검사가 아니다.

위에서 언급한 내용들을 효율적인 부분, 체계적인 부분을 구별하는 것부터 시작해보자.

---

### 테스트 피라미드

테스트 수준에는 `단위 테스트`, `통합 테스트`, `시스템 테스트`, `수동 테스트`가 정의되어 있습니다.

여기서 이야기 하고 싶은 내용은 `어떤 구성요소를 단위 테스트 대상으로 하고, 어떤 구성요소는 시스템 테스트의 대상으로 할 것인지`를 구분하는 것입니다.

계약을 명확하게 하기, 사전, 사후 조건에 대해 정의하기, 알고리즘 및 단일 비즈니스 로직을 테스트하는 것은 `단위 테스트`의 대상입니다.
이와 같은 기준에서 벗어나는 경우 상위 테스트로 넘어갑니다.

시스템의 일부를 테스트해야 하는 경우(DB), SQL 쿼리를 검증해야 하는 경우 등 테스트 대상 구성요소가 외부 구성요소와 상호작용이 필요한 경우 `통합 테스트`를 작성합니다.

특정 서비스에 대한 사용자의 행위를 정의하고, 전체 애플리케이션이 예상대로 동작하는지 검증하기 위해서 `시스템 테스트`를 작성합니다.

탐색 및 유효성 검사에 초점을 맞추어 수행하려는 경우 `수동 테스트`를 진행합니다.


---

### 테스트 별 사용 목적

- `단위 테스트`
  - 모든 비즈니스 규칙에 대한 테스트를 진행
  - 작업 단위에 대해 정의하고, 시스템에서 작업 단위를 호출하는 자동화된 코드조각을 테스트
  - 장점으로는 빠르고, 다루기 쉽고, 작성하기 쉽다.
  - 단점은 비즈니스와 현실성이 떨어지고, 단위 테스트 만으로 잡을 수 없는 버그가 존재한다.

- `통합 테스트`
  - 단위 테스트를 통과한 모든 작업 단위를 통합하는 테스트
  - 시스템의 여러 구성요소들을 함께 테스트하는 것으로, 시스템 전체를 테스트 하는 대신 특정 구성요소들의 `상호작용에 초점`을 둔다.

- `시스템 테스트`
  - 애플리케이션에서 주요하고, 위험한 실행 흐름에 대한 테스트를 진행
  - 모든 클래스, 의존성, 데이터베이스, 웹 서비스 등 시스템이 포함하고 있는 모든 구성요소를 테스트
  - 하위 테스트 보다 현실성있는 테스트를 진행할 수 있다.
  - 하지만, 테스트를 작성하기 어렵고, 외부 환경의 상황에 민감하고, 실행하는데 시간이 오래 걸린다.

---

`이펙티브 소프트웨어 테스팅`이라는 책의 1장의 내용은 키워드를 정의하고, 테스트 코드를 작성하는 환경과 그렇지 않은 환경에 대한 워크 플로우를 비교하여 중요성 느낄 수 있도록 해주었고, 테스트 수준을 구분하여 테스트를 작성하는 것에 대한 방향성을 제시해주었다.

중요한 것은 현재 상황에 어떤 테스트가 필요한지 파악하는 것이 우선이라 생각한다. 


