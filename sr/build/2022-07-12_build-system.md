날짜: 2022-07-12 20:51

# 빌드 시스템과 빌드 철학

tag: #daily #todolist

reference: [구글 엔지니어는 이렇게 일한다.](http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&ejkGb=KOR&barcode=9791162245620)

---

## Header

지난 번 포스팅 때는 뜬금없이 업무 내용 중에 빌드 서버를 구축해야하는 내용이 있어서 프로젝트를 서버에서 빌드하는 방법 중의 하나인 Ant 빌드에 대해서 소개했다.

최근에 부분적으로 읽고 있는 `"구글 엔지니어는 이렇게 일한다."`라는 책에 빌드 시스템에 대한 내용이 있어 간략하게 필요한 부분만 요약해서 정리한다.

## Body

빌드 시스템의 목적은 엔지니어들이 작성한 소스코드를 기계가 읽을 수 있는 바이너리로 변환하는 것이다.
다양한 빌드 시스템이 존재하고, 각각의 빌드 시스템의 결과물은 크게 다르지 않다. 그럼에도 구글에서는 훌륭한 빌드 시스템에 대한 기준을 두 가지 속성에 대해서 이야기 한다.

첫 번째로 속도, 빌드 시스템은 개발자가 명령 하나로 빌드를 수행하고 몇 초 안에 결과 바이너리를 얻을 수 있어야 한다.

두 번째로 정확성, 소스 파일과 기타 입력 데이터가 같다면 모든 개발자가 어떤 컴퓨터에서 빌드하더라도 동일한 결과를 내어줘야 한다.

빌드 시스템은 테스트, 프로덕션에 릴리즈하기 위해 자동으로 빌드를 수행하는 역할도 한다.
`자동 빌드 시스템`은 개발자의 워크 플로우에 지대한 영향 미치는 몇 가지 예를 들어본다.

1. 사람의 개입없이 코드가 자동으로 빌드되고, 테스트 된 후에 프로덕션에 배포된다. 팀마다 각자에 적합한 빌드 주기를 설정하여 매주, 매일 혹은 빌드 시스템이 허락하는 한 최대한 빠르게 새로운 빌드를 배포한다.
2. 개발자 변경사항은 자동 테스트되어 코드 리뷰용으로 전달된다. 따라서 새로운 변경 때문에 빌드나 테스트에 문제가 생기면 변경 작성자와 리뷰어 모두 즉시 알 수 있다.
3. 변경이 트렁크에 병합되기 전에 다시 테스트되어 파괴적인 변경이 스며들기 어렵다.
4. 저수준의 라이브러리 제작자는 변경을 전체 코드베이스를 대상으로 테스트하여 수백만 개의 테스트를 모두 통과하고 다른 바이너리들과 문제없이 동작하는지 확인할 수 있다.
5. 엔지니어들이 한 번에 수만 개의 소스 파일을 건드리는 대규모 변경을 생각하면서도 안전하게 서브밋하고 테스트 할 수 있다.

모든 회사가 이와 같은 효과를 누릴 수 있다라고는 장담할 수는 없으나, 현대적인 빌드 시스템을 제대로 활용하고 있다면 규모에 상관없이 모든 조직이 비슷한 효과를 누릴 수 있다.

### 만약 빌드 시스템이 없다면? 컴파일러로 부족한가?

사실 javac같은 컴파일러를 직접 실행시키는 것만으로도 컴파일은 가능하다. 하지만 우리가 맞닥들이는 프로젝트는 단순하게 자바코드만 있진 않다.
javac도 코드에서 임포트한 파일이 현재 디렉토리의 하위 디렉토리에 있기만 하면 잘 찾아내지만, 다른 프로젝트와 공유하는 라이브러리처럼 파일 시스템의 다른 곳에 저장된 코드까지는 찾아내지는 못한다.
의존 관계를 생각해서 각 조각을 올바른 순서로, 그 조각에 적합한 도구를 이용해 빌드해야 한다. 의존 관계가 달라지면 이 과정을 반복해서 이전 바이너리에 의존하지 않도록 해줘야 한다.

컴파일러는 외부 의존성을 다루는 방법을 전혀 모른다. 빌드 시스템 없이 해결하기 위해서는 필요한 라이브러리를 인터넷에서 내려받아 lib 디렉토리에 넣고 컴파일러가 이 디렉토리에서 라이브러리를 읽어가도록 설정하는 방법이 최선이다.
하지만 시간이 지나면 lib 디렉토리에 어떤 라이브러리들을 넣어놨는지, 어디서 가져왔는지, 여전히 사용 중인지를 잊어버리게 된다. 그리고 메인테이너가 최신 버전이 나올 때마다 잘 업데이트해놓기를 기도해야 한다.

### 모던 빌드 시스템

#### 태스크 기반 빌드 시스템

셸 스크립트가 기본적인 태스트 기반 빌드 시스템(task-based build system)의 좋은 예시이다.
태스크 기반 빌드 시스템에서의 기본 작업 단위는 당연히 태스크이다. 각 태스크는 어떠한 로직을 수행할 수 있는 일종의 스크립트이며 다른 태스크와의 의존 관계를 명시하여 반드시 먼저 수행할 수 있다. 오늘날 많이 쓰이는 Ant, Maven, Gradle, Grunt, Rake 같은 시스템들이 대표적인 태스트 기반 빌드 시스템이다.

대부분 모던 빌드 시스템은 셸 스크립트 대신 빌드 파일을 이용한다. 빌드 파일은 빌드 수행 방법을 기술한 파일이다.
일련의 태스크들로 빌드 방법을 정의한 간단한 메타데이터를 작성하고, Ant의 태스크들을 정의한 명령들을 순서대로 실행한다.

Ant는 2000년에 처음 릴리즈된 오래된 소프트웨어로 모던 빌드 시스템 범주에 넣기는 애매하다.
Maven과 Gradle 같은 다른 도구들이 Ant를 확장하여 외부 의존성 자동 관리 같은 기능을 추가하고, XML을 걷어내어 문법도 간결해졌다.

하지만 기본은 변하지 않았다. 엔지니어가 태스크를 모듈화하여 빌드 파일을 작성해야 하며, 태스크를 실행할 도구들을 제공하고, 그 사이의 의존성을 관리해줘야 한다.

태스크 기반 빌드 시스템의 문제점을 해결하는 방안으로 아티팩트 기반 빌드 시스템을 개발하여 태스크 중심 빌드 시스템보다 확장성과 안정성을 누릴 수 있었다.

하지만 여기서는 아티팩트 중심 빌드 시스템에 대한 내용은 생략한다.

## Footer

빌드 시스템의 역할은 시간이 흐르고, 규모가 커져도 코드를 쉽게 다룰 수 있게 해주는 것이다. 소프트웨어 엔지니어링이 항상 그렇듯, 어떤 형태의 빌드 시스템을 이용하느냐에 따른 트레이드 오프가 존재한다.

빌드 시스템은 엔지니어링 조직에서 매우 중요한 요소이다. 모든 개발자가 하루 수십에서 수백번을 이용하며, 많은 경우 그들의 생산성을 좌우하는 결정적인 역할을 한다.
이는 올바른 빌드 시스템을 구축하는 방법을 고민하고 시간을 투자할 가치가 충분하다는 뜻이다.

`빌드 시스템에 대한 고찰`을 해봄으로써 엔지니어의 힘과 유연성을 제한해야 프로젝트의 생산성을 높일 수 있다는 사실을 알게 해준다.

엔지니어에게 `빌드 수행 방식`을 정의할 수 있는 자유를 주는 것보다 고도로 구조화된 프레임워크를 개발하여 개인의 선택을 제한하고 가장 중요한 결정을 자동화 도구에게 위임하여 엔지니어들에게 자신의 어플리케이션을 작성하는 일에 집중할 수 있는 시간을 벌어주는 것이 빌드 시스템의 목적이다.